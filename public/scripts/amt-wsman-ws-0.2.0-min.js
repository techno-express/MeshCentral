<<<<<<< HEAD
var CreateWsmanComm=function(e,t,r,n,a){var c={};function o(){for(i in c.socketState=2,c.pendingAjaxCall)c.sendRequest(c.pendingAjaxCall[i][0],c.pendingAjaxCall[i][3],c.pendingAjaxCall[i][4])}function s(e){for(c.socketAccumulator+=function(e){return String.fromCharCode.apply(null,e)}(new Uint8Array(e.data));;){if(0==c.socketParseState){var t=c.socketAccumulator.indexOf("\r\n\r\n");if(t<0)return;if(c.socketHeader=c.socketAccumulator.substring(0,t).split("\r\n"),null==c.amtVersion)for(var r in c.socketHeader)0==c.socketHeader[r].indexOf("Server: Intel(R) Active Management Technology ")&&(c.amtVersion=c.socketHeader[r].substring(46));for(r in c.socketAccumulator=c.socketAccumulator.substring(t+4),c.socketParseState=1,c.socketData="",c.socketXHeader={Directive:c.socketHeader[0].split(" ")},c.socketHeader)if(0!=r){var n=c.socketHeader[r].indexOf(":");c.socketXHeader[c.socketHeader[r].substring(0,n).toLowerCase()]=c.socketHeader[r].substring(n+2)}}if(1==c.socketParseState){var a=-1;if(null==c.socketXHeader.connection||"close"!=c.socketXHeader.connection.toLowerCase()||null!=c.socketXHeader["transfer-encoding"]&&"chunked"==c.socketXHeader["transfer-encoding"].toLowerCase())if(null!=c.socketXHeader["content-length"]){if(a=parseInt(c.socketXHeader["content-length"]),c.socketAccumulator.length<a)return;var o=c.socketAccumulator.substring(0,a);c.socketAccumulator=c.socketAccumulator.substring(a),c.socketData=o,a=0}else{var s=c.socketAccumulator.indexOf("\r\n");if(s<0)return;if(a=parseInt(c.socketAccumulator.substring(0,s),16),isNaN(a))return void(c.websocket&&c.websocket.close());if(c.socketAccumulator.length<s+2+a+2)return;o=c.socketAccumulator.substring(s+2,s+2+a);c.socketAccumulator=c.socketAccumulator.substring(s+2+a+2),c.socketData+=o}else a=0;0==a&&(l(c.socketXHeader,c.socketData),c.socketParseState=0,c.socketHeader=null)}}}function l(e,t){var r=parseInt(e.Directive[1]);if(isNaN(r)&&(r=602),401==r&&++c.authcounter<3){if(c.challengeParams=c.parseDigest(e["www-authenticate"]),null!=c.challengeParams.qop){var n=c.challengeParams.qop.split(",");for(var a in n)n[a]=n[a].trim();0<=n.indexOf("auth-int")?c.challengeParams.qop="auth-int":c.challengeParams.qop="auth"}}else{var o=c.pendingAjaxCall.shift();c.authcounter=0,c.ActiveAjaxCount--,c.gotNextMessages(t,"success",{status:r},o),c.PerformNextAjax()}}function u(e){if(c.socketState=0,null!=c.socket&&(c.socket.close(),c.socket=null),0<c.pendingAjaxCall.length){var t=c.pendingAjaxCall.shift(),r=t[5];c.PerformAjaxExNodeJS2(t[0],t[1],t[2],t[3],t[4],--r)}}return c.PendingAjax=[],c.ActiveAjaxCount=0,c.MaxActiveAjaxCount=1,c.FailAllError=0,c.challengeParams=null,c.noncecounter=1,c.authcounter=0,c.socket=null,c.socketState=0,c.host=e,c.port=t,c.user=r,c.pass=n,c.tls=a,c.tlsv1only=1,c.cnonce=Math.random().toString(36).substring(7),c.PerformAjax=function(e,t,r,n,a,o){c.ActiveAjaxCount<c.MaxActiveAjaxCount&&0==c.PendingAjax.length?c.PerformAjaxEx(e,t,r,a,o):1==n?c.PendingAjax.unshift([e,t,r,a,o]):c.PendingAjax.push([e,t,r,a,o])},c.PerformNextAjax=function(){if(!(c.ActiveAjaxCount>=c.MaxActiveAjaxCount||0==c.PendingAjax.length)){var e=c.PendingAjax.shift();c.PerformAjaxEx(e[0],e[1],e[2],e[3],e[4]),c.PerformNextAjax()}},c.PerformAjaxEx=function(e,t,r,n,a){if(0==c.FailAllError)return e=e||"",c.ActiveAjaxCount++,c.PerformAjaxExNodeJS(e,t,r,n,a);c.gotNextMessagesError({status:c.FailAllError},"error",null,[e,t,r,n,a])},c.pendingAjaxCall=[],c.PerformAjaxExNodeJS=function(e,t,r,n,a){c.PerformAjaxExNodeJS2(e,t,r,n,a,3)},c.PerformAjaxExNodeJS2=function(e,t,r,n,a,o){if(o<=0||0!=c.FailAllError)return c.ActiveAjaxCount--,999!=c.FailAllError&&c.gotNextMessages(null,"error",{status:0==c.FailAllError?408:c.FailAllError},[e,t,r,n,a]),void c.PerformNextAjax();c.pendingAjaxCall.push([e,t,r,n,a,o]),0==c.socketState?c.xxConnectHttpSocket():2==c.socketState&&c.sendRequest(e,n,a)},c.sendRequest=function(e,t,r){var n=(r=r||"POST")+" "+(t=t||"/wsman")+" HTTP/1.1\r\n";if(null!=c.challengeParams){var a=hex_md5(hex_md5(c.user+":"+c.challengeParams.realm+":"+c.pass)+":"+c.challengeParams.nonce+":"+c.noncecounter+":"+c.cnonce+":"+c.challengeParams.qop+":"+hex_md5(r+":"+t+("auth-int"==c.challengeParams.qop?":"+hex_md5(e):"")));n+="Authorization: "+c.renderDigest({username:c.user,realm:c.challengeParams.realm,nonce:c.challengeParams.nonce,uri:t,qop:c.challengeParams.qop,response:a,nc:c.noncecounter++,cnonce:c.cnonce})+"\r\n"}!function(e){if(2==c.socketState&&null!=c.socket&&c.socket.readyState==WebSocket.OPEN){for(var t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);try{c.socket.send(t.buffer)}catch(e){}}}(n+="Host: "+c.host+":"+c.port+"\r\nTransfer-Encoding: chunked\r\n\r\n"+e.length.toString(16).toUpperCase()+"\r\n"+e+"\r\n0\r\n\r\n")},c.parseDigest=function(e){return function(e){return e.split(",").reduce(function(e,t){return e.ic?e.st[e.st.length-1]+=","+t:e.st.push(t),t.split('"').length%2==0&&(e.ic=!e.ic),e},{st:[],ic:!1}).st}(e.substring(7)).reduce(function(e,t){var r=t.trim().split("=");return e[r[0]]=r[1].replace(new RegExp('"',"g"),""),e},{})},c.renderDigest=function(r){var e=[];for(i in r)e.push(i);return"Digest "+e.reduce(function(e,t){return e+","+t+'="'+r[t]+'"'},"").substring(1)},c.xxConnectHttpSocket=function(){c.socketParseState=0,c.socketAccumulator="",c.socketHeader=null,c.socketData="",c.socketState=1,c.socket=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/webrelay.ashx?p=1&host="+c.host+"&port="+c.port+"&tls="+c.tls+"&tlsv1only="+c.tlsv1only+("*"==r?"&serverauth=1":"")+(void 0===n?"&serverauth=1&user="+r:"")),c.socket.binaryType="arraybuffer",c.socket.onopen=o,c.socket.onmessage=s,c.socket.onclose=u},c.gotNextMessages=function(e,t,r,n){999!=c.FailAllError&&(0==c.FailAllError?200==r.status?n[1](e,200,n[2]):n[1](null,r.status,n[2]):n[1](null,c.FailAllError,n[2]))},c.gotNextMessagesError=function(e,t,r,n){999!=c.FailAllError&&(0==c.FailAllError?n[1](c,null,{Header:{HttpError:e.status}},e.status,n[2]):n[1](null,c.FailAllError,n[2]))},c.CancelAllQueries=function(e){for(;0<c.PendingAjax.length;){var t=c.PendingAjax.shift();t[1](null,e,t[2])}null!=c.websocket&&(c.websocket.close(),c.websocket=null,c.socketState=0)},c}
=======
var CreateWsmanComm=function(e,t,n,r,a){var s={};function o(){for(i in s.socketState=2,s.pendingAjaxCall)s.sendRequest(s.pendingAjaxCall[i][0],s.pendingAjaxCall[i][3],s.pendingAjaxCall[i][4])}function c(e){for(s.socketAccumulator+=(e=new Uint8Array(e.data),String.fromCharCode.apply(null,e));;){if(0==s.socketParseState){var t,n=s.socketAccumulator.indexOf("\r\n\r\n");if(n<0)return;if(s.socketHeader=s.socketAccumulator.substring(0,n).split("\r\n"),null==s.amtVersion)for(var r in s.socketHeader)0==s.socketHeader[r].indexOf("Server: Intel(R) Active Management Technology ")&&(s.amtVersion=s.socketHeader[r].substring(46));for(r in s.socketAccumulator=s.socketAccumulator.substring(n+4),s.socketParseState=1,s.socketData="",s.socketXHeader={Directive:s.socketHeader[0].split(" ")},s.socketHeader)0!=r&&(t=s.socketHeader[r].indexOf(":"),s.socketXHeader[s.socketHeader[r].substring(0,t).toLowerCase()]=s.socketHeader[r].substring(t+2))}if(1==s.socketParseState){var a=-1;if(null==s.socketXHeader.connection||"close"!=s.socketXHeader.connection.toLowerCase()||null!=s.socketXHeader["transfer-encoding"]&&"chunked"==s.socketXHeader["transfer-encoding"].toLowerCase())if(null!=s.socketXHeader["content-length"]){if(a=parseInt(s.socketXHeader["content-length"]),s.socketAccumulator.length<a)return;var o=s.socketAccumulator.substring(0,a);s.socketAccumulator=s.socketAccumulator.substring(a),s.socketData=o,a=0}else{n=s.socketAccumulator.indexOf("\r\n");if(n<0)return;if(a=parseInt(s.socketAccumulator.substring(0,n),16),isNaN(a))return void(s.websocket&&s.websocket.close());if(s.socketAccumulator.length<n+2+a+2)return;o=s.socketAccumulator.substring(n+2,n+2+a);s.socketAccumulator=s.socketAccumulator.substring(n+2+a+2),s.socketData+=o}else a=0;0==a&&(function(e,t){var n=parseInt(e.Directive[1]);isNaN(n)&&(n=602);if(401==n&&++s.authcounter<3){if(s.challengeParams=s.parseDigest(e["www-authenticate"]),null!=s.challengeParams.qop){var r,a=s.challengeParams.qop.split(",");for(r in a)a[r]=a[r].trim();0<=a.indexOf("auth-int")?s.challengeParams.qop="auth-int":s.challengeParams.qop="auth"}}else{e=s.pendingAjaxCall.shift();s.authcounter=0,s.ActiveAjaxCount--,s.gotNextMessages(t,"success",{status:n},e),s.PerformNextAjax()}}(s.socketXHeader,s.socketData),s.socketParseState=0,s.socketHeader=null)}}}function l(e){var t,n;s.socketState=0,null!=s.socket&&(s.socket.close(),s.socket=null),0<s.pendingAjaxCall.length&&(n=(t=s.pendingAjaxCall.shift())[5],s.PerformAjaxExNodeJS2(t[0],t[1],t[2],t[3],t[4],--n))}return s.PendingAjax=[],s.ActiveAjaxCount=0,s.MaxActiveAjaxCount=1,s.FailAllError=0,s.challengeParams=null,s.noncecounter=1,s.authcounter=0,s.socket=null,s.socketState=0,s.host=e,s.port=t,s.user=n,s.pass=r,s.tls=a,s.tlsv1only=1,s.cnonce=Math.random().toString(36).substring(7),s.PerformAjax=function(e,t,n,r,a,o){s.ActiveAjaxCount<s.MaxActiveAjaxCount&&0==s.PendingAjax.length?s.PerformAjaxEx(e,t,n,a,o):1==r?s.PendingAjax.unshift([e,t,n,a,o]):s.PendingAjax.push([e,t,n,a,o])},s.PerformNextAjax=function(){var e;s.ActiveAjaxCount>=s.MaxActiveAjaxCount||0==s.PendingAjax.length||(e=s.PendingAjax.shift(),s.PerformAjaxEx(e[0],e[1],e[2],e[3],e[4]),s.PerformNextAjax())},s.PerformAjaxEx=function(e,t,n,r,a){if(0==s.FailAllError)return e=e||"",s.ActiveAjaxCount++,s.PerformAjaxExNodeJS(e,t,n,r,a);s.gotNextMessagesError({status:s.FailAllError},"error",null,[e,t,n,r,a])},s.pendingAjaxCall=[],s.PerformAjaxExNodeJS=function(e,t,n,r,a){s.PerformAjaxExNodeJS2(e,t,n,r,a,3)},s.PerformAjaxExNodeJS2=function(e,t,n,r,a,o){if(o<=0||0!=s.FailAllError)return s.ActiveAjaxCount--,999!=s.FailAllError&&s.gotNextMessages(null,"error",{status:0==s.FailAllError?408:s.FailAllError},[e,t,n,r,a]),void s.PerformNextAjax();s.pendingAjaxCall.push([e,t,n,r,a,o]),0==s.socketState?s.xxConnectHttpSocket():2==s.socketState&&s.sendRequest(e,r,a)},s.sendRequest=function(e,t,n){var r=(n=n||"POST")+" "+(t=t||"/wsman")+" HTTP/1.1\r\n";null!=s.challengeParams&&(n=hex_md5(hex_md5(s.user+":"+s.challengeParams.realm+":"+s.pass)+":"+s.challengeParams.nonce+":"+s.noncecounter+":"+s.cnonce+":"+s.challengeParams.qop+":"+hex_md5(n+":"+t+("auth-int"==s.challengeParams.qop?":"+hex_md5(e):""))),r+="Authorization: "+s.renderDigest({username:s.user,realm:s.challengeParams.realm,nonce:s.challengeParams.nonce,uri:t,qop:s.challengeParams.qop,response:n,nc:s.noncecounter++,cnonce:s.cnonce})+"\r\n"),function(e){if(2==s.socketState&&null!=s.socket&&s.socket.readyState==WebSocket.OPEN){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);try{s.socket.send(t.buffer)}catch(e){}}}(r+="Host: "+s.host+":"+s.port+"\r\nTransfer-Encoding: chunked\r\n\r\n"+e.length.toString(16).toUpperCase()+"\r\n"+e+"\r\n0\r\n\r\n")},s.parseDigest=function(e){return e.substring(7).split(",").reduce(function(e,t){return e.ic?e.st[e.st.length-1]+=","+t:e.st.push(t),t.split('"').length%2==0&&(e.ic=!e.ic),e},{st:[],ic:!1}).st.reduce(function(e,t){t=t.trim().split("=");return e[t[0]]=t[1].replace(new RegExp('"',"g"),""),e},{})},s.renderDigest=function(n){var e=[];for(i in n)e.push(i);return"Digest "+e.reduce(function(e,t){return e+","+t+'="'+n[t]+'"'},"").substring(1)},s.xxConnectHttpSocket=function(){s.socketParseState=0,s.socketAccumulator="",s.socketHeader=null,s.socketData="",s.socketState=1,s.socket=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/webrelay.ashx?p=1&host="+s.host+"&port="+s.port+"&tls="+s.tls+"&tlsv1only="+s.tlsv1only+("*"==n?"&serverauth=1":"")+(void 0===r?"&serverauth=1&user="+n:"")),s.socket.binaryType="arraybuffer",s.socket.onopen=o,s.socket.onmessage=c,s.socket.onclose=l},s.gotNextMessages=function(e,t,n,r){999!=s.FailAllError&&(0==s.FailAllError?200==n.status?r[1](e,200,r[2]):r[1](null,n.status,r[2]):r[1](null,s.FailAllError,r[2]))},s.gotNextMessagesError=function(e,t,n,r){999!=s.FailAllError&&(0==s.FailAllError?r[1](s,null,{Header:{HttpError:e.status}},e.status,r[2]):r[1](null,s.FailAllError,r[2]))},s.CancelAllQueries=function(e){for(;0<s.PendingAjax.length;){var t=s.PendingAjax.shift();t[1](null,e,t[2])}null!=s.websocket&&(s.websocket.close(),s.websocket=null,s.socketState=0)},s}
>>>>>>> upstream/master
